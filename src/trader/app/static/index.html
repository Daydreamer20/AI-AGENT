<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AI Trading Agent - Chat</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #0f172a; color: #e2e8f0; margin: 0; }
		.container { max-width: 800px; margin: 0 auto; padding: 24px; }
		h1 { font-size: 20px; margin: 0 0 12px; }
		.panel { background: #111827; border: 1px solid #1f2937; border-radius: 8px; overflow: hidden; }
		.messages { height: 60vh; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 10px; }
		.msg { padding: 10px 12px; border-radius: 8px; max-width: 80%; white-space: pre-wrap; word-wrap: break-word; }
		.msg.user { align-self: flex-end; background: #2563eb; color: white; }
		.msg.bot { align-self: flex-start; background: #1f2937; color: #e5e7eb; }
		.input-row { display: flex; gap: 8px; padding: 12px; border-top: 1px solid #1f2937; background: #0b1220; }
		input[type="text"] { flex: 1; padding: 10px 12px; border-radius: 6px; border: 1px solid #374151; background: #0b1220; color: #e5e7eb; }
		button { padding: 10px 14px; border-radius: 6px; border: 1px solid #374151; background: #10b981; color: #06291f; font-weight: 600; cursor: pointer; }
		button:disabled { opacity: 0.6; cursor: not-allowed; }
	</style>
</head>
<body>
	<div class="container">
		<h1>AI Trading Agent Chat</h1>
		<div class="panel">
			<div id="messages" class="messages"></div>
			<div class="input-row">
				<input id="input" type="text" placeholder="Type a message... Try: decision, ticker bybit BTCUSDT" />
				<button id="send">Send</button>
			</div>
		</div>
	</div>
	<script>
		const messagesEl = document.getElementById('messages');
		const inputEl = document.getElementById('input');
		const sendEl = document.getElementById('send');

		function addMessage(text, role) {
			const div = document.createElement('div');
			div.className = `msg ${role}`;
			div.textContent = text;
			messagesEl.appendChild(div);
			messagesEl.scrollTop = messagesEl.scrollHeight;
		}

		async function sendMessage() {
			const text = inputEl.value.trim();
			if (!text) return;
			addMessage(text, 'user');
			inputEl.value = '';
			sendEl.disabled = true;
			try {
				const resp = await fetch('/chat', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ message: text })
				});
				if (!resp.ok) throw new Error('Network error');
				const data = await resp.json();
				addMessage(data.reply ?? JSON.stringify(data), 'bot');
			} catch (e) {
				addMessage('Error: ' + e.message, 'bot');
			} finally {
				sendEl.disabled = false;
				inputEl.focus();
			}
		}

		sendEl.addEventListener('click', sendMessage);
		inputEl.addEventListener('keydown', (e) => {
			if (e.key === 'Enter' && !e.shiftKey) {
				e.preventDefault();
				sendMessage();
			}
		});
	</script>
</body>
</html>