<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>AI Trading Agent - Chat</title>
	<style>
		:root { color-scheme: light dark; }
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; margin: 0; padding: 0; background: canvas; color: canvastext; }
		header { padding: 16px; border-bottom: 1px solid lightgray; }
		main { max-width: 800px; margin: 0 auto; padding: 16px; display: grid; gap: 16px; }
		.card { border: 1px solid lightgray; border-radius: 12px; padding: 16px; background: Canvas; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
		.row { display: flex; gap: 8px; align-items: center; }
		input[type="text"] { flex: 1; padding: 10px 12px; border: 1px solid lightgray; border-radius: 8px; font-size: 16px; background: Field; color: FieldText; }
		button { padding: 10px 14px; border-radius: 8px; border: 1px solid transparent; background: #2563eb; color: white; cursor: pointer; font-weight: 600; }
		button:disabled { opacity: .6; cursor: not-allowed; }
		pre { white-space: pre-wrap; word-wrap: break-word; font-size: 14px; }
		.small { color: GrayText; font-size: 13px; }
		kbd { background: #eee; border: 1px solid #ccc; border-bottom-width: 2px; border-radius: 4px; padding: 0 4px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace; }
	</style>
</head>
<body>
	<header>
		<h1>AI Trading Agent</h1>
	</header>
	<main>
		<section class="card">
			<h2>Chat</h2>
			<div class="row">
				<input id="message" type="text" placeholder="Type a message (e.g., decision)" />
				<button id="send">Send</button>
			</div>
			<div class="small">Tips: try <kbd>decision</kbd> or <kbd>signal</kbd>. For live tickers use <kbd>GET /ticker/{exchange}/{symbol}</kbd>, e.g. <a href="/ticker/bybit/BTCUSDT" target="_blank">/ticker/bybit/BTCUSDT</a>.</div>
		</section>

		<section class="card">
			<h3>Response</h3>
			<pre id="output">Awaiting input…</pre>
		</section>
	</main>

	<script>
		const $ = (id) => document.getElementById(id);
		const input = $("message");
		const btn = $("send");
		const out = $("output");

		async function sendMessage() {
			const text = (input.value || "").trim();
			if (!text) {
				out.textContent = "Please enter a message.";
				return;
			}
			btn.disabled = true;
			out.textContent = "Sending…";
			try {
				const resp = await fetch("/chat", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ message: text })
				});
				if (!resp.ok) {
					throw new Error(`HTTP ${resp.status}`);
				}
				const data = await resp.json();
				out.textContent = typeof data.reply === "string" ? data.reply : JSON.stringify(data, null, 2);
			} catch (err) {
				out.textContent = `Error: ${err}`;
			} finally {
				btn.disabled = false;
			}
		}

		btn.addEventListener("click", sendMessage);
		input.addEventListener("keydown", (e) => {
			if (e.key === "Enter") {
				sendMessage();
			}
		});
	</script>
</body>
</html>